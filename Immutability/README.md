# Immutability üßä

## –ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç üß≠
–ù–µ–∏–∑–º–µ–Ω—è–µ–º—ã–π –æ–±—ä–µ–∫—Ç –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–µ –º–µ–Ω—è–µ—Ç —Å–≤–æ—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –õ—é–±–∞—è ¬´–º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è¬ª –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç. –≠—Ç–æ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –∫–ª–∞—Å—Å –±–∞–≥–æ–≤, –≥–¥–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–µ–Ω—è–µ—Ç—Å—è –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ ‚Äî –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ –æ–±—ä–µ–∫—Ç–∞ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏.

## –ü—Ä–æ–±–ª–µ–º–∞ –º—É—Ç–∞–±–µ–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ ‚ö†Ô∏è
–í—ã –ø–µ—Ä–µ–¥–∞–ª–∏ `$order` –≤ `NotificationService`, –≤–Ω—É—Ç—Ä–∏ –Ω–µ–≥–æ –∫—Ç–æ-—Ç–æ —Å–ª—É—á–∞–π–Ω–æ –∏–∑–º–µ–Ω–∏–ª —Å—Ç–∞—Ç—É—Å. –û–±—ä–µ–∫—Ç –≤–µ—Ä–Ω—É–ª—Å—è ¬´–∏—Å–ø–æ—Ä—á–µ–Ω–Ω—ã–º¬ª, –∞ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–∏—Å –ø–æ–ª—É—á–∏–ª —É–∂–µ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –æ—Ç–ø—Ä–∞–≤–∏–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.

## –†–µ—à–µ–Ω–∏–µ ‚úÖ
–ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –Ω–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å, —Ç–∞–∫–æ–π –±–∞–≥ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω: ¬´–∏–∑–º–µ–Ω–µ–Ω–∏–µ¬ª —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç –∏ –Ω–µ —Ç—Ä–æ–≥–∞–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π.

## –ó–∞–ø–∞—Ö–∏ –∫–æ–¥–∞ üß™
- –°–µ—Ç—Ç–µ—Ä—ã –Ω–∞ DTO.
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π –æ–±—ä–µ–∫—Ç–∞ —Å–Ω–∞—Ä—É–∂–∏.
- –ú–µ—Ç–æ–¥—ã –≤–∏–¥–∞ `setStatus()`, `setAmount()`.

## ‚ùå –ë—ã–ª–æ (–ü–ª–æ—Ö–æ)
–ú—É—Ç–∞–±–µ–ª—å–Ω—ã–π `Order` —Å —Å–µ—Ç—Ç–µ—Ä–∞–º–∏ –ø–µ—Ä–µ–¥–∞–Ω –≤ –¥–≤–∞ —Å–µ—Ä–≤–∏—Å–∞ ‚Äî –æ–¥–∏–Ω –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å, –≤—Ç–æ—Ä–æ–π –ø–æ–ª—É—á–∞–µ—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

```php
final class Order
{
    public function __construct(
        public int $id,
        public string $status,
        public float $amount
    ) {}

    public function setStatus(string $status): void
    {
        $this->status = $status;
    }
}

$order = new Order(10, 'new', 150.0);
$payment->capture($order); // –º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –Ω–∞ paid
$notifier->send($order);   // –≤–∏–¥–∏—Ç paid, —Ö–æ—Ç—è –∂–¥–∞–ª–∏ new
```

## ‚úÖ –°—Ç–∞–ª–æ (–•–æ—Ä–æ—à–æ)
`readonly`-–æ–±—ä–µ–∫—Ç –∏ wither-–º–µ—Ç–æ–¥—ã: –∫–∞–∂–¥—ã–π –≤—ã–∑–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä.

```php
readonly class OrderSnapshot
{
    public function __construct(
        public int $id,
        public OrderStatus $status,
        public Money $amount
    ) {}

    public function withStatus(OrderStatus $status): self
    {
        return new self($this->id, $status, $this->amount);
    }
}
```

## PHP 8.4 –∏ Asymmetric Visibility üîí
–ò–Ω–æ–≥–¥–∞ –æ–±—ä–µ–∫—Ç –¥–æ–ª–∂–µ–Ω **–Ω–µ–º–Ω–æ–≥–æ** –º–µ–Ω—è—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –Ω–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –¥–æ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã. –í PHP 8.4 –º–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å —á—Ç–µ–Ω–∏–µ –Ω–∞—Ä—É–∂—É, –∞ –∑–∞–ø–∏—Å—å –∑–∞–ø—Ä–µ—Ç–∏—Ç—å: `public private(set)`.

```php
final class Order
{
    public function __construct(
        public private(set) OrderStatus $status
    ) {}

    public function confirm(): void
    {
        $this->status = OrderStatus::Confirmed;
    }
}
```

–¢–∞–∫ –≤—ã –∑–∞—â–∏—â–∞–µ—Ç–µ –ø–æ–ª—è –æ—Ç –≤–Ω–µ—à–Ω–µ–π –∑–∞–ø–∏—Å–∏, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç–µ —É–ø—Ä–∞–≤–ª—è–µ–º—É—é –º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Å–∞.

## –ú–∏–Ω–∏-—á–µ–∫–ª–∏—Å—Ç üîé
- –ù—É–∂–Ω–∞ –≥–∞—Ä–∞–Ω—Ç–∏—è –Ω–µ–∏–∑–º–µ–Ω–Ω–æ—Å—Ç–∏? –î–µ–ª–∞–π—Ç–µ –æ–±—ä–µ–∫—Ç `readonly`.
- –ù—É–∂–Ω—ã –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è? –í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç —á–µ—Ä–µ–∑ wither.
- –ù—É–∂–Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–∞—è –º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å? –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `public private(set)` –∏ –¥–æ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã.
