# Fail-Fast

## Что это значит
Fail-Fast — принцип, по которому система должна обнаруживать ошибку как можно раньше и сразу сообщать о ней. Невалидные данные должны приводить к исключению при создании объекта или на входе в метод, а не при записи в БД или отправке платёжного запроса. Так вы ловите проблему в правильном месте и в правильном контексте.

## Аналогия
Лучше получить ошибку на входе в ресторан: "мест нет", чем сесть, заказать, подождать час и узнать, что блюда не будет.

## Запахи кода
- Проверки в середине метода, когда часть работы уже сделана.
- Возврат null вместо исключения для явно невалидного состояния.
- Silent failures: поймал исключение и ничего не сделал.

## Пример: плохо
Проверка валидности находится на 15-й строке, когда уже были обращения к API:

```php
public function chargeCustomer(int $customerId, float $amount): void
{
    $this->paymentApi->reserveSlot($customerId);
    $this->paymentApi->prepareCharge($customerId, $amount);

    if ($amount <= 0) {
        throw new \InvalidArgumentException('Amount must be positive.');
    }

    $this->paymentApi->charge($customerId, $amount);
}
```

## Пример: хорошо
Валидации вынесены в Money Value Object и guard clauses в начале метода — исключение кидается мгновенно:

```php
public function chargeCustomer(int $customerId, Money $amount): void
{
    Guard::positiveInt($customerId, 'customerId');

    $this->paymentApi->charge($customerId, $amount->asFloat());
}
```

## Exception vs Error в PHP 8.4
- Exception — это ожидаемые ошибки уровня домена/валидации: неправильные аргументы, нарушение бизнес-правил, невозможность выполнить операцию. Их можно обрабатывать в приложении.
- Error — это ошибки уровня исполнения или фатальные условия: проблемы с типами, обращение к несуществующим методам, ошибки интерпретатора. Их, как правило, не следует ловить для обычного потока выполнения.

В fail-fast вы бросаете Exception (например, InvalidArgumentException) при невалидных данных. Error используйте только для программных ошибок или системных сбоев.
