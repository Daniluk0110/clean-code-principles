# Command Query Separation ‚öñÔ∏è

## –î–≤–∞ —Ç–∏–ø–∞ –º–µ—Ç–æ–¥–æ–≤ üéØ
- **–ö–æ–º–∞–Ω–¥–∞ (Command)** ‚Äî `void`-–º–µ—Ç–æ–¥, –º–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –Ω–∏—á–µ–≥–æ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç.
- **–ó–∞–ø—Ä–æ—Å (Query)** ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ.

## –ü–æ—á–µ–º—É —Å–º–µ—à–∏–≤–∞—Ç—å –æ–ø–∞—Å–Ω–æ ‚ö†Ô∏è
`$items = $cart->clearAndReturnItems()` –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –±—É–¥–µ—Ç –æ—á–∏—â–∞—Ç—å –∫–æ—Ä–∑–∏–Ω—É –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ. –í—Ç–æ—Ä–æ–π –≤—ã–∑–æ–≤ —É–∂–µ –≤–µ—Ä–Ω—ë—Ç –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤, –∞ –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Ç–æ–ª—å–∫–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å, –ø—Ä–∏–¥—ë—Ç—Å—è –ø–ª–∞—Ç–∏—Ç—å –∑–∞ –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã. –¢–∞–∫–æ–π –º–µ—Ç–æ–¥ –Ω–µ–ª—å–∑—è –±–µ–∑–æ–ø–∞—Å–Ω–æ –∫–µ—à–∏—Ä–æ–≤–∞—Ç—å, –ø–æ–≤—Ç–æ—Ä–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –æ—Ç–ª–∞–¥–∫–µ.

## –ó–∞–ø–∞—Ö–∏ –∫–æ–¥–∞ üß™
- –ú–µ—Ç–æ–¥—ã, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∏ –º–µ–Ω—è—é—â–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.
- –ì–µ—Ç—Ç–µ—Ä—ã —Å –ø–æ–±–æ—á–Ω—ã–º–∏ —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `getBalance()` –≤—ã–∑—ã–≤–∞–µ—Ç `syncWithBank()`).
- `save()`/`persist()` –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç ID –∏–ª–∏ —Å—É—â–Ω–æ—Å—Ç—å ‚Äî —ç—Ç–æ —Å–º–µ—à–∏–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É –∏ –∑–∞–ø—Ä–æ—Å.

## ‚ùå –ë—ã–ª–æ (–ü–ª–æ—Ö–æ)
```php
class UserRegistrationService
{
    public function registerUser(string $email, string $name): User
    {
        $user = $this->repository->create($email, $name);
        $this->eventBus->dispatch(new SendWelcomeEmail($user));
        return $user;
    }
}
```
–ú–µ—Ç–æ–¥ —Å–æ–∑–¥–∞—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –±–µ—Ä—ë—Ç –µ–≥–æ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ —Ä–∞—Å—Å—ã–ª–∞–µ—Ç email. –ö—Ä–æ–º–µ —Ç–æ–≥–æ, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `User` –∏ —Ç–µ–ø–µ—Ä—å –Ω–µ–ª—å–∑—è –≤—ã–∑–≤–∞—Ç—å –µ–≥–æ –¥–≤–∞–∂–¥—ã –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–∞–∫ –∫–æ–º–∞–Ω–¥—É.

## ‚úÖ –°—Ç–∞–ª–æ (–•–æ—Ä–æ—à–æ)
```php
final class RegisterUserCommand
{
    public function __construct(public string $email, public string $name) {}
}

final class RegisterUserHandler
{
    public function __construct(private UserRepository $repository, private EventBus $eventBus) {}

    public function handle(RegisterUserCommand $command): void
    {
        $user = $this->repository->create($command->email, $command->name);
        $this->eventBus->dispatch(new SendWelcomeEmail($user));
    }
}
```
–¢–µ–ø–µ—Ä—å –∫–æ–º–∞–Ω–¥–∞ `handle` —Ç–æ–ª—å–∫–æ –º–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∞ –∑–∞–ø—Ä–æ—Å—ã `findUserByEmail(Email $email): User` –∏ `findUserById(UserId $id): User` –∂–∏–≤—É—Ç –æ—Ç–¥–µ–ª—å–Ω–æ –∏ –º–æ–≥—É—Ç –±—ã—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω—ã.

## üìö CQS vs CQRS
CQS ‚Äî —ç—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –ø—Ä–æ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Å–∞. CQRS (Command Query Responsibility Segregation) ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω: –∫–æ–º–∞–Ω–¥—ã –∏ –∑–∞–ø—Ä–æ—Å—ã —É—Ö–æ–¥—è—Ç –≤ —Ä–∞–∑–Ω—ã–µ –º–æ–¥–µ–ª–∏/—Å–µ—Ä–≤–∏—Å—ã. –í CQRS –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–¥–µ–ª–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤, –æ—Å—Ç–∞–≤–ª—è—è –∫–æ–º–∞–Ω–¥—ã —á–∏—Å—Ç—ã–º–∏. CQS –∑–∞–¥–∞—ë—Ç –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞, –∞ CQRS –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç –∏—Ö –Ω–∞ –≤–µ—Å—å –ø—Ä–æ–µ–∫—Ç.

## –ú–∏–Ω–∏-—á–µ–∫–ª–∏—Å—Ç üîé
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä—É–π –º–µ—Ç–æ–¥ –∫–∞–∫ –ª–∏–±–æ –∫–æ–º–∞–Ω–¥—É, –ª–∏–±–æ –∑–∞–ø—Ä–æ—Å.
- –ö–æ–º–∞–Ω–¥–∞ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ–ª–∂–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –¥–∞–Ω–Ω—ã–µ, –∫—Ä–æ–º–µ, –≤–æ–∑–º–æ–∂–Ω–æ, —Å—Ç–∞—Ç—É—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
- –ó–∞–ø—Ä–æ—Å –Ω–µ –º–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–∫–æ–ª—å–∫–æ —É–≥–æ–¥–Ω–æ —Ä–∞–∑.
